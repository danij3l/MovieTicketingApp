<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Movie Tickeding App</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ultra&display=swap" rel="stylesheet">
  </head>

  <body>
    <div class="banner">
      <img src="images/logo.jpg">
    </div>
    <div class="container">
      <h2>Avalable shows<h2>



          <!--Hobbit-->
          <a href="#time">
            <div class="grid">
              <img class="movieThumbnail" src="images/hobbit.jpg">
              <ul class="movieDescription" id="hobbit">
                <div class="movieTitle">Hobbit</div>
                <li>Duration: 140 min</li>
                <li>Genre: Fantasy</li>
                <li>Description: Bilbo is going for an adventure</li>
              </ul>
              <ul class="movieAvalability" id="hobbit">
                <li>Monday - 17:00 (3D)</li>
                <li>Wenesday - 21:00</li>
              </ul>
            </div>
          </a>

          <!--Lotr-->
          <a href="#time">
            <div class="grid">
              <img class="movieThumbnail" src="images/lotr.jpg">

              <ul class="movieDescription" id="lotr">
                <div class="movieTitle">Lord of the Rings</div>
                <li>Duration: 160 min</li>
                <li>Genre: Fantasy</li>
                <li>Description: One does not simply walk into Mordor </li>
              </ul>

              <ul class="movieAvalability" id="lotr">
                <li>Monday - 16:30</li>
                <li>Tuesday - 22:00</li>
              </ul>
            </div>
          </a>


          <!--Matrix-->
          <a href="#time">
            <div class="grid">
              <img class="movieThumbnail" src="images/matrix.jpg">

              <ul class="movieDescription" id="matrix">
                <div class="movieTitle">The Matrix</div>
                <li>Duration: 140 min</li>
                <li>Genre: Action</li>
                <li>Description: Blue pill or red pill ^^ </li>
              </ul>

              <ul class="movieAvalability" id="matrix">
                <li>Monday - 17:00</li>
                <li>Wenesday - 20:00</li>
                <li>Friday - 22:30</li>
              </ul>
            </div>
          </a>

          <!--John Wick-->
          <a href="#time">
            <div class="grid">
              <img class="movieThumbnail" src="images/john.jpg">

              <ul class="movieDescription" id="john">
                <div class="movieTitle">John Wick</div>
                <li>Duration: 150 min</li>
                <li>Genre: Action</li>
                <li>Description: Enter Baba Jaga </li>
              </ul>

              <ul class="movieAvalability" id="john">
                <li>Monday - 15:00</li>
                <li>Wenesday - 18:00</li>
                <li>Friday - 22:00</li>
              </ul>
            </div>
          </a>



          <!--Time Selector-->
          <div id="time" class="selection">
            <h2 id="time">First select time of play</h2>
            <select id="timeSelector" class="selector" onchange="billDataSplitter()">
              <option>Select time of play</option>
              <optgroup label="Hobbit">
                <option value="12,Wenesday - 21:00,Hobbit">Wenesday - 21:00 (12€)</option>
                <option value="15,Friday - 17:00,Hobbit 3D">Friday - 17:00 (15€)</option>

              </optgroup>
              <optgroup label="LOTR">
                <option value="12,Monday - 16:30, Lord Of The rings">Monday 16:30 (12€)</option>
                <option value="18,Monday - 17:30, Lord Of The rings (4DX)">Tuesday 17:30 (18€)</option>
              </optgroup>
              <optgroup label="Matrix">
                <option value="8,Monday - 17:00, Matrix">Monday 17:00 (8€)</option>
                <option value="8,Sunday - 19:00, Matrix">Sunday 19:00 (8€)</option>
                <option value="10,Friday - 22:30, Matrix 3DX">Friday - 22:30 (10€)</option>
              </optgroup>
              <optgroup label="John Wick">
                <option value="12,Wenesday - 18:00, John Wick">Wenesday - 18:00 (12€)</option>
                <option value="15,Friday - 22:00,John Wick (Gold Class)">Friday - 22:00 (15€)</option>
              </optgroup>
            </select>
          </div>
          
          <!--  form that takes array of times for each show
          <form name="frmRadio" id="radio-buttons" action="">
            <input type="radio" id="radio-hobbit" name="option" onclick="change(this)">Hobbit
            <input type="radio" id="radio-lotr" name="option" onclick="change(this)">Lord Of the rings &nbsp;&nbsp;
            <select id="arrays">
              <option id="items"></option>
            </select>
          </form> -->

          <div class="selection">
            <h2>Select seats</h2>

            <ul class="seatStatuses">
              <li>
                <div class="defaultSeat"></div>
                <small class="status" style="font-size: 1em;">Avalable</small>
              </li>
              <li>
                <div class="seatSelected"></div>
                <small class="status" style="font-size: 1em;">Selected</small>
              </li>
              <li>
                <div class="seatOccupied"></div>
                <small class="status" style="font-size: 1em;">Occupied</small>
              </li>
            </ul>

            <div class="screen"></div>

            <div class="seats" id="theatarSeats"></div>
          </div>



          <div id="bill" class="billingDetails">
            <h2>Billing Details</h2>

            <!--Displaying selected movie-->
            <h3>Show selected</h3>
            <input id="billData.show" class="billDisplay" placeholder="None">


            <!--Displaying selected time-->
            <h3>Time of show</h3>
            <input id="billData.timeOfShow" class="billDisplay" placeholder="None">

            <h3>
              You have selected <span class="countAndPrice" id="count">0</span>
              tickets for a price of €<span class="countAndPrice" aria-placeholder="" id="total">0</span>
              <br> 
              You have reserved seats with numbers: <span class="seatingPositions" id="seatingPositions"></span>
            </h3>

          </div>

    </div>



    <script>

      class Movie {
        constructor(name, timesOfShow, price) {
          this.name = name;
          this.timesOfShow = timesOfShow;
          this.price = price;
        }

        passDate(indexOfDate) {
          return this.timesOfShow[indexOfDate];
        }
      }

      var hobbit = new Movie('Hobbit', [new Date("March 4 2022 17:00"), new Date("March 5 2022 18:00"), new Date("March 6 2022 19:00")], 10)
      var lotr = new Movie('Lotr', [new Date("April 4 2022 17:00"), new Date("April 5 2022 18:00"), new Date("April 6 2022 19:00")], 10)

      // Function that is going to change the select options
      function fillSelect(values) {
        document.getElementById("arrays").innerHTML =
          values.reduce((tmp, x) => `${tmp}<option>${x}</option>`, '');
      }

      function change(radio) {
        if (radio.checked && radio.id === 'radio-hobbit.timesOfShow') {
          fillSelect(hobbit.timesOfShow);
        } else {
          fillSelect(lotr.timesOfShow);
        }
      }

      //import required for $
      var script = document.createElement('script');
      script.src = 'https://code.jquery.com/jquery-3.4.1.min.js';
      script.type = 'text/javascript';
      document.getElementsByTagName('head')[0].appendChild(script);

      const container = document.getElementById("theatarSeats");

      function makeSeats(rows, cols) {
        container.style.setProperty('--grid-rows', rows);
        container.style.setProperty('--grid-cols', cols);
        for (c = 0; c < (rows * cols); c++) {
          let seat = document.createElement("button");
          seat.innerText = (c + 1);
          //adding class Name to each seat
          container.appendChild(seat).className = "seat";
          //adding id to each seat
          container.appendChild(seat).id = c + 1;
        }
      };

      makeSeats(6, 7);

      //hardcode occuping usuially most picked seats
      document.getElementById(25).className = 'seatOccupied';
      document.getElementById(26).className = 'seatOccupied';
      document.getElementById(31).className = 'seatOccupied';
      document.getElementById(32).className = 'seatOccupied';
      document.getElementById(33).className = 'seatOccupied';
      document.getElementById(34).className = 'seatOccupied';
      document.getElementById(37).className = 'seatOccupied';
      document.getElementById(38).className = 'seatOccupied';

      var show;
      //Function that splits three strings from option value and assigns them to the bill section
      function billDataSplitter(value) {

        //$( "#theatarSeats" ).load(window.location.href + " #theatarSeats" ); // should reset seat positions but throws error because there's no server

        var price = $('#timeSelector').val().split(',')[0];
        var time = $('#timeSelector').val().split(',')[1];
        var show = $('#timeSelector').val().split(',')[2];
        document.getElementById("billData.show").value = show;
        document.getElementById("billData.timeOfShow").value = time;
      }

      var count = 0;
      var seats = document.getElementsByClassName("seat");
      var seatingPositions = [];

      for (var i = 0; i < seats.length; i++) {
        var item = seats[i];

        item.addEventListener("click", (event) => {
          var price = $('#timeSelector').val().split(',')[0];

          // allowing user to pick seats only after picking the show
          if (document.getElementById("billData.show").value == '') {
            alert("Sorry :( \n\nFirst pick the time of show in menu above, then you can select seats for given show.");
            return;

          }
          if (!event.target.classList.contains('seatOccupied') && !event.target.classList.contains('seatSelected')) {
            count++;
            event.target.classList.add("seatSelected");
            seatingPositions.push(event.target.innerHTML);
          }
          else {
            count--;
            event.target.classList.remove("seatSelected");
            seatingPositions.pop(event.target.innerHTML);
          }
          var total = count * price;
          document.getElementById("count").innerText = count;
          document.getElementById("total").innerText = total;

          //sorting seating position ascendingly no matter in which order user picks
          seatingPositions.sort((a,b)=>a-b);
          document.getElementById("seatingPositions").innerText = seatingPositions;
        })
      }

    </script>
  </body>

</html>